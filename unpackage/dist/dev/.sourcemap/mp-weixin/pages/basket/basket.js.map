{"version":3,"sources":["uni-app:///main.js","webpack:////Users/zhengheci/hlshop/mall4uni/pages/basket/basket.vue?ec2f","webpack:////Users/zhengheci/hlshop/mall4uni/pages/basket/basket.vue?e0b7","webpack:////Users/zhengheci/hlshop/mall4uni/pages/basket/basket.vue?7325","webpack:////Users/zhengheci/hlshop/mall4uni/pages/basket/basket.vue?aab0","uni-app:///pages/basket/basket.vue","webpack:////Users/zhengheci/hlshop/mall4uni/pages/basket/basket.vue?e07e","webpack:////Users/zhengheci/hlshop/mall4uni/pages/basket/basket.vue?6d7b","webpack:////Users/zhengheci/hlshop/mall4uni/wxs/number.wxs?e75a","webpack:////Users/zhengheci/hlshop/mall4uni/wxs/number.wxs?2cc0"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","shopcartItems","checkedItems","subtractMoney","totalMoney","prodid","shopcartItemId","skuSelectData","selectNum","isEdit","attr","components","skuSelect","props","onLoad","onReady","onShow","http","onHide","computed","allChecked","fullImagePath","methods","loadBasketData","uni","url","method","callBack","console","toFirmOrder","shopcartItemIds","title","icon","toggleEdit","onSelAll","shopcartItem","isChecked","ths","onSelectedItem","checkAllSelected","calTotalPrice","shopcartIds","onCountMinus","onCountPlus","updateCount","mask","itemCount","prodId","skuId","onDelBasket","content","confirmColor","success","onDelItem","onDelChosedItems","toProdPage","updateSku","e","moveHandle","closeSkuselect","hasSku","itemIndex","onPopupClose","onPopupChange"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,eAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA+S;AAC/S;AAC0D;AACL;AACa;;;AAGlE;AAC6M;AAC7M,gBAAgB,iNAAU;AAC1B,EAAE,4EAAM;AACR,EAAE,6QAAM;AACR,EAAE,sRAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,iRAAU;AACZ;AACA;;AAEA;AACwL;AACxL,WAAW,qMAAM,iBAAiB,6MAAM;;AAExC;AACe,gF;;;;;;;;;;;;AC3Bf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,sTAEN;AACP,KAAK;AACL;AACA,aAAa,gQAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACjEA;AAAA;AAAA;AAAA;AAAqzB,CAAgB,oyBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC+Jz0B;AACA,WAAW,mBAAO,CAAC,6BAAqB;AACxC,aAAa,mBAAO,CAAC,+BAAuB;AAC5C;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA,eAGA;EACAC;IACA;MACA;MACA;MACAC;MACAC;MACAC;MACAC;MAEAC;MACAC;MAEAC;MACAC;MACAC;MACAC;IACA;EACA;EAEAC;IAAAC;EAAA;EACAC;EAEA;AACA;AACA;EACAC;EAEA;AACA;AACA;EACAC;EAEA;AACA;AACA;EACAC;IACA;IACAC;EACA;;EAEAC;IACA;MACAT;IACA;IACA;EACA;EACAU;IACAC;MACA;QAAA;MAAA;IACA;IACAC;MACA;QAAA;MAAA;IACA;EACA;EACAC;IACA;IACA;IAEA;IACA;IACA;IACA;IACA;IAEAC;MAAA;MACAC;;MAEA;QACAC;QACAC;QACA1B;QACA2B;UACA;YACA;YACAC;YACA;cACA3B;cACAG;YACA;UACA;YACA;cACAH;YACA;UACA;UACAuB;QACA;MACA;MACAP;IACA;IACA;AACA;AACA;IACAY;MACA;MACA;MACA5B;QACA;UACA6B;QACA;MACA;MAEA;QACAN;UACAO;UACAC;QACA;QACA;MACA;MAEAR;MACAA;QACAC;MACA;IACA;IAEAQ;MACA;QACAxB;MACA;IACA;IAEA;AACA;AACA;IACAyB;MACA;MACAd;;MAEA;MACA;MAEA;QACA;QACAe;QACAL;MACA;MAEA;MACAN;MACA;QACAC;QACAC;QACA1B;UACA8B;UAAA;UACAM;QACA;QACAT;UACAU;YACApC;YAEAG;UACA;UACAoB;QACA;MACA;MACAP;MAEA;IACA;;IAEA;AACA;AACA;IACAqB;MACA;;MAEA;;MAEA;MACA;MAEA;MACAd;MACA;QACAC;QACAC;QACA1B;UACA8B;UAAA;UACAM;QACA;QACAT;UACA1B;UACAoC;YACApC;YAEAG;UACA;UACAoB;QACA;MACA;MACAP;IACA;IAEA;AACA;AACA;IACAsB;MACA;MACA;MAEA;QACA;QACA;UACAnB;UACA;QACA;MACA;MAEA;QACAA;MACA;IACA;IAEA;AACA;AACA;IACAoB;MACA;MACA;MAEA;QACA;QAEA;UACAC;QACA;MACA;MAEA;QACA;MACA;MAEA;MACAjB;MACA;QACAC;QACAC;QACA1B;UAAA8B;QAAA;QACAH;UACAU;YACAjC;UACA;UACAoB;QACA;MACA;MACAP;IACA;IAEA;AACA;AACA;IACAyB;MACA;MACA;MACA;MAEA;QACA;MACA;QACA;QACAlB;UACAO;UACAC;QACA;MACA;IACA;IAEA;AACA;AACA;IACAW;MACA;MACA;MACA;IACA;IAEA;AACA;AACA;IACAC;MACA;MACApB;QACAqB;MACA;MACA;QACApB;QACAC;QACA1B;UACA8C;UACAxC;UACAyC;UACAC;QACA;QACArB;UACA1B;UACAoC;YACApC;YACAG;UACA;UACAoB;UACAP;QACA;MACA;;MACAA;IACA;IAEA;AACA;AACA;IACAgC;MACA;MACA;MAEA;QACAzB;UACAO;UACAC;QACA;MACA;QACAR;UACAO;UACAmB;UACAC;UAEAC;YACA;cACA5B;gBACAqB;cACA;cACA;gBACApB;gBACAC;gBACA1B;kBAAA8B;gBAAA;gBACAH;kBACA;kBACA1B,qCACA;oBAAA;kBAAA,EACA;kBACAoC;oBACApC;oBACAG;kBACA;kBACAoB;gBACA;cACA;cACAP;YACA;UACA;QACA;MACA;IACA;IAEAoC;MACA;MACA;MACA;MACAvB;MACA;IACA;IAEAwB;MACA;MAEA;MAEA;QACA;QAEA;UACAxB;QACA;MACA;MACA;IACA;IAEAyB;MACA;MAEA;QACA/B;UACAC;QACA;MACA;IACA;IAEA;IACA+B;MAAA;MACAC;MACA;MACA;MACA;MACA;MAEA;MACA;MACA;QACAhC;QACAC;QAEAC;UACAC;UACA;YACArB;YACAF;YACAC;YACAE;YACAE;UACA;UAEA;QACA;MACA;MACAO;IACA;IAEAyC;MACA;IAAA,CACA;IACAC;MACA;QACA;QACA;UAAAvD;QAAA;QACA;QACA;QACA;QACA;QACA;QACA;UACA;UACA;UACA,IACA+B,oCACAA,+CACA;YACAyB;YACA;YACAzB;YACAlC;UACA;UACA;YACA4D;UACA;QACA;QAEA;UACA;UACA5D;QACA;QACA;QAAA,KACA;UACA;UACAkC;UACAA;UACAA;UACAlC;QACA;QACA;UAAAA;QAAA;MACA;MACA;IACA;IACA6D;MACA;IACA;IAEAC;MACA;QACA;UACAxD;QACA;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;AC9nBA;AAAA;AAAA;AAAA;AAA4pC,CAAgB,imCAAG,EAAC,C;;;;;;;;;;;ACAhrC;AACA,OAAO,KAAU,EAAE,kBAKd;;;;;;;;;;;;;ACNL;AAAA;AAAA,wCAAsV,CAAgB,sZAAG,EAAC,C;;;;;;;;;;;;ACA1W;AAAe;AACf;AACA;AACA;;AAEA,M","file":"pages/basket/basket.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/basket/basket.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./basket.vue?vue&type=template&id=1ebf6306&filter-modules=eyJ3eHMiOnsidHlwZSI6InNjcmlwdCIsImNvbnRlbnQiOiIiLCJzdGFydCI6NTIxMiwiYXR0cnMiOnsibW9kdWxlIjoid3hzIiwibGFuZyI6Ind4cyIsInNyYyI6Ii4uLy4uL3d4cy9udW1iZXIud3hzIn0sImVuZCI6NTIxMn19&\"\nvar renderjs\nimport script from \"./basket.vue?vue&type=script&lang=js&\"\nexport * from \"./basket.vue?vue&type=script&lang=js&\"\nimport style0 from \"./basket.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\n/* custom blocks */\nimport block0 from \"../../wxs/number.wxs?vue&type=custom&index=0&blockType=script&issuerPath=%2FUsers%2Fzhengheci%2Fhlshop%2Fmall4uni%2Fpages%2Fbasket%2Fbasket.vue&module=wxs&lang=wxs\"\nif (typeof block0 === 'function') block0(component)\n\ncomponent.options.__file = \"pages/basket/basket.vue\"\nexport default component.exports","export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./basket.vue?vue&type=template&id=1ebf6306&filter-modules=eyJ3eHMiOnsidHlwZSI6InNjcmlwdCIsImNvbnRlbnQiOiIiLCJzdGFydCI6NTIxMiwiYXR0cnMiOnsibW9kdWxlIjoid3hzIiwibGFuZyI6Ind4cyIsInNyYyI6Ii4uLy4uL3d4cy9udW1iZXIud3hzIn0sImVuZCI6NTIxMn19&\"","var components\ntry {\n  components = {\n    uniIcons: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-icons/components/uni-icons/uni-icons\" */ \"@/uni_modules/uni-icons/components/uni-icons/uni-icons.vue\"\n      )\n    },\n    uniPopup: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-popup/components/uni-popup/uni-popup\" */ \"@/uni_modules/uni-popup/components/uni-popup/uni-popup.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.shopcartItems.length\n  var l0 =\n    g0 > 0\n      ? _vm.__map(_vm.shopcartItems, function (prod, index) {\n          var $orig = _vm.__get_orig(prod)\n          var m0 = _vm.toString(prod.prodId)\n          var m1 = _vm.fullImagePath(prod.sku.pic)\n          return {\n            $orig: $orig,\n            m0: m0,\n            m1: m1,\n          }\n        })\n      : null\n  var g1 = _vm.shopcartItems.length\n  var g2 = _vm.shopcartItems.length\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        l0: l0,\n        g1: g1,\n        g2: g2,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./basket.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./basket.vue?vue&type=script&lang=js&\"","<template>\n  <!--pages/basket/basket.wxml-->\n  <view class=\"container\">\n    <view class=\"head-title\">\n      <image class=\"head-logo\" src=\"../../static/images/logo/image.png\"></image>\n      <view class=\"head-text\">红丽外贸服装 </view>\n      <text class=\"head-more\"></text>\n      <view class=\"head-edit\" @tap=\"toggleEdit\">{{\n        isEdit ? \"完成\" : \"编辑\"\n      }}</view>\n    </view>\n    <view class=\"prod-list\" v-if=\"shopcartItems.length > 0\">\n      <!-- <block v-for=\"(item, scIndex) in shopcartItemDiscounts\" :key=\"scIndex\"> -->\n      <view class=\"prod-block\">\n        <view class=\"discount-tips\" v-if=\"chooseDiscountItemDto\">\n          <text class=\"text-block\">{{\n            wxs.parseDiscount(chooseDiscountItemDto.discountRule)\n          }}</text>\n          <text class=\"text-list\">{{\n            wxs.parseDiscountMsg(\n              chooseDiscountItemDto.discountRule,\n              chooseDiscountItemDto.needAmount,\n              chooseDiscountItemDto.discount\n            )\n          }}</text>\n        </view>\n      </view>\n      <block v-for=\"(prod, index) in shopcartItems\" :key=\"index\">\n        <view class=\"item\" :data-prodid=\"prod.prodId\">\n          <view class=\"btn\">\n            <label>\n              <checkbox\n                @tap=\"onSelectedItem\"\n                :data-index=\"index\"\n                :value=\"toString(prod.prodId)\"\n                :checked=\"prod.isChecked\"\n                color=\"#105c3e\"\n              ></checkbox>\n            </label>\n          </view>\n          <view class=\"prodinfo\">\n            <view class=\"pic\">\n              <view\n                class=\"prod-pic\"\n                :style=\"{\n                  backgroundImage: `url(${fullImagePath(prod.sku.pic)})`,\n                }\"\n              ></view>\n            </view>\n            <view class=\"opt\">\n              <view class=\"prod-name\">{{ prod.sku.prodName }}</view>\n              <text\n                @tap=\"updateSku\"\n                :data-categoryid=\"prod.sku.categoryId\"\n                :data-attr=\"prod.sku.attr\"\n                :data-prodid=\"prod.prodId\"\n                :data-shopcartitemid=\"prod.shopcartItemId\"\n                :data-index=\"index\"\n                :data-selectnum=\"prod.itemCount\"\n                :class=\"'prod-info-text ' + (prod.sku.skuName ? '' : 'empty-n')\"\n                >{{ prod.sku.skuName }}</text\n              >\n              <view class=\"price-count\">\n                <view class=\"price\">\n                  <text class=\"symbol\">￥</text>\n                  <text class=\"big-num\">{{ prod.sku.price }}</text>\n                </view>\n                <view v-if=\"!isEdit\" class=\"m-numSelector\">\n                  <view\n                    @tap=\"onCountMinus\"\n                    class=\"minus\"\n                    :data-index=\"index\"\n                  ></view>\n                  <input type=\"number\" :value=\"prod.itemCount\" disabled />\n                  <view\n                    @tap=\"onCountPlus\"\n                    class=\"plus\"\n                    :data-scindex=\"scIndex\"\n                    :data-index=\"index\"\n                  ></view>\n                </view>\n                <view v-else @tap=\"onDelItem\" :data-index=\"index\" class=\"m-icon\"\n                  ><uni-icons\n                    type=\"minus-filled\"\n                    size=\"25\"\n                    color=\"#EC6817\"\n                  ></uni-icons\n                ></view>\n              </view>\n            </view>\n          </view>\n        </view>\n      </block>\n    </view>\n\n    <view class=\"empty\" v-if=\"shopcartItems.length == 0\">\n      <view class=\"img\">\n        <image src=\"/static/images/tabbar/basket.png\"></image>\n      </view>\n      <view class=\"txt\"> 您还没有添加任何商品哦~ </view>\n    </view>\n\n    <!-- 底部按钮 -->\n    <view class=\"cart-footer\" v-if=\"shopcartItems.length > 0\">\n      <view class=\"btn all\">\n        <label @tap=\"onSelAll\">\n          <checkbox :checked=\"allChecked\" color=\"#f7d731;\"></checkbox\n          >全选</label\n        >\n      </view>\n\n      <view class=\"btn total\">\n        <view v-show=\"!isEdit\" class=\"finally\">\n          <text>合计:</text>\n          <view class=\"price\">\n            <text class=\"symbol\">￥</text>\n            <text class=\"big-num\">{{ totalMoney }}</text>\n          </view>\n        </view>\n        <view class=\"total-msg\" v-if=\"subtractMoney > 0\">\n          总额:￥{{ wxs.toPrice(totalMoney) }} 立减:￥{{\n            wxs.toPrice(subtractMoney)\n          }}\n        </view>\n      </view>\n      <view v-if=\"!isEdit\" class=\"btn settle\" @tap=\"toFirmOrder\">\n        <text>结算</text>\n      </view>\n      <view v-else class=\"btn settle\" @tap=\"onDelChosedItems\">\n        <text>删除</text>\n      </view>\n    </view>\n    <!-- end 底部按钮 -->\n    <!-- 底部弹出 -->\n    <uni-popup\n      ref=\"skuselect\"\n      @touchmove.stop.prevent=\"moveHandle\"\n      type=\"bottom\"\n      :animation=\"false\"\n      @change=\"onPopupChange\"\n    >\n      <skuSelect\n        :skuSelectData=\"skuSelectData\"\n        :prodId=\"prodid\"\n        :selectNum=\"selectNum\"\n        :shopcartItemId=\"shopcartItemId\"\n        :hasBottom=\"false\"\n        :attr=\"attr\"\n        :updateSku=\"true\"\n        @close-popup=\"closeSkuselect\"\n      >\n      </skuSelect>\n    </uni-popup>\n  </view>\n</template>\n\n<script module=\"wxs\" lang=\"wxs\" src=\"../../wxs/number.wxs\"></script>\n\n<script>\n// pages/basket/basket.js\nvar http = require(\"../../utils/http.js\"); // var config = require(\"../../utils/config.js\");\nvar config = require(\"../../utils/config.js\");\nconst Big = require(\"../../utils/big.min.js\");\nimport skuSelect from \"@/components/sku-select/sku-select.vue\";\n\nexport default {\n  data() {\n    return {\n      // picDomain: config.picDomain,\n      //shopcartItemDiscounts: [],\n      shopcartItems: [],\n      checkedItems: [],\n      subtractMoney: 0,\n      totalMoney: 0,\n\n      prodid: 0,\n      shopcartItemId: 0,\n\n      skuSelectData: {},\n      selectNum: 1,\n      isEdit: false,\n      attr: \"\",\n    };\n  },\n\n  components: { skuSelect },\n  props: {},\n\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad: function (options) {},\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady: function () {},\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow: function () {\n    this.loadBasketData();\n    http.getCartCount(); //重新计算购物车总数量\n  },\n\n  onHide: function () {\n    this.setData({\n      isEdit: false,\n    });\n    this.onPopupClose();\n  },\n  computed: {\n    allChecked() {\n      return this.shopcartItems.every((item) => item.isChecked);\n    },\n    fullImagePath() {\n      return (path) => config.staticUrl + path;\n    },\n  },\n  methods: {\n    //4.28 修改,规整接口,重后端\n    //基本思路就是,每当修改前端修改购物车数据时,后端更新购物车数据并计算总价返回,前端根据总价渲染页面,其余渲染逻辑由前端自行完成,不通过后端数据修改\n\n    //1.初始化购物车数据: 后端返回购物车所有数据用于渲染页面（包括总价）\n    //2. 修改sku: 后端只更新对应购物车项的数据(或者和其他购物车项合并), 然后只返回总价用于渲染页面,前端自行根据选择的sku渲染页面(后端不会返回新的购物车数据)\n    //3.增加、减少数量\n    //4.删除: 后端更新购物车数据, 返回总价用于渲染页面, 数量自行渲染(后端不会返回新的购物车数据)\n    //5. 选择(全选): 后端更新购物车数据, 然后返回总价\n\n    loadBasketData() {\n      uni.showLoading(); //加载购物车\n\n      var params = {\n        url: \"/shopcart/shopcartItem/info\",\n        method: \"POST\",\n        data: {},\n        callBack: (res) => {\n          if (res.shopcartItems.length > 0) {\n            //渲染购物车商品\n            console.log(res.shopcartItems[0].sku);\n            this.setData({\n              shopcartItems: res.shopcartItems,\n              totalMoney: res.totalPay,\n            });\n          } else {\n            this.setData({\n              shopcartItems: [],\n            });\n          }\n          uni.hideLoading();\n        },\n      };\n      http.request(params);\n    },\n    /**\n     * 去结算\n     */\n    toFirmOrder: function () {\n      var shopcartItems = this.shopcartItems;\n      var shopcartItemIds = [];\n      shopcartItems.forEach((shopcartItem) => {\n        if (shopcartItem.isChecked) {\n          shopcartItemIds.push(shopcartItem.shopcartItemId);\n        }\n      });\n\n      if (!shopcartItemIds.length) {\n        uni.showToast({\n          title: \"请选择商品\",\n          icon: \"none\",\n        });\n        return;\n      }\n\n      uni.setStorageSync(\"shopcartItemIds\", JSON.stringify(shopcartItemIds));\n      uni.navigateTo({\n        url: \"/pages/submit-order/submit-order?orderEntry=0\",\n      });\n    },\n\n    toggleEdit: function () {\n      this.setData({\n        isEdit: !this.isEdit,\n      });\n    },\n\n    /**\n     * 全选\n     */\n    onSelAll: function () {\n      var allChecked = this.allChecked;\n      allChecked = !allChecked; //改变状态\n\n      var shopcartItems = this.shopcartItems;\n      var shopcartItemIds = [];\n\n      for (var i = 0; i < shopcartItems.length; i++) {\n        var shopcartItem = shopcartItems[i];\n        shopcartItem.isChecked = allChecked;\n        shopcartItemIds.push(shopcartItem.shopcartItemId);\n      }\n\n      var ths = this;\n      uni.showLoading();\n      var params = {\n        url: \"/shopcart/shopcartItem/changeItemChecked\",\n        method: \"POST\",\n        data: {\n          shopcartItemIds: shopcartItemIds, //\n          isChecked: allChecked,\n        },\n        callBack: function (res) {\n          ths.setData({\n            shopcartItems: shopcartItems,\n\n            totalMoney: res,\n          });\n          uni.hideLoading();\n        },\n      };\n      http.request(params);\n\n      this.calTotalPrice(); //计算总价\n    },\n\n    /**\n     * 每一项的选择事件\n     */\n    onSelectedItem: function (e) {\n      var index = e.currentTarget.dataset.index; // 获取data- 传进来的index\n\n      var shopcartItems = this.shopcartItems; // 获取购物车列表\n\n      var isChecked = shopcartItems[index].isChecked; // 获取当前商品的选中状态\n      var shopcartItemId = shopcartItems[index].shopcartItemId;\n\n      var ths = this;\n      uni.showLoading();\n      var params = {\n        url: \"/shopcart/shopcartItem/changeItemChecked\",\n        method: \"POST\",\n        data: {\n          shopcartItemIds: [shopcartItemId], //\n          isChecked: !isChecked,\n        },\n        callBack: function (res) {\n          shopcartItems[index].isChecked = !isChecked; // 改变状态\n          ths.setData({\n            shopcartItems: shopcartItems,\n\n            totalMoney: res,\n          });\n          uni.hideLoading();\n        },\n      };\n      http.request(params);\n    },\n\n    /**\n     * 检查全选状态\n     */\n    checkAllSelected: function () {\n      var allChecked = true;\n      var shopcartItems = this.shopcartItems;\n\n      for (var i = 0; i < shopcartItems.length; i++) {\n        var shopcartItem = shopcartItems[i];\n        if (!shopcartItem.checked) {\n          allChecked = !allChecked;\n          break;\n        }\n      }\n\n      this.setData({\n        allChecked: allChecked,\n      });\n    },\n\n    /**\n     * 计算购物车总额\n     */\n    calTotalPrice: function () {\n      var shopcartItems = this.shopcartItems;\n      var shopcartIds = [];\n\n      for (var i = 0; i < shopcartItems.length; i++) {\n        var shopcartItem = shopcartItems[i];\n\n        if (shopcartItem.checked) {\n          shopcartIds.push(shopcartItem.shopcartItemId);\n        }\n      }\n\n      if (shopcartIds.length === 0) {\n        return;\n      }\n\n      var ths = this;\n      uni.showLoading();\n      var params = {\n        url: \"/shopcart/shopcartItem/totalPay\",\n        method: \"POST\",\n        data: { shopcartItemIds: shopcartIds },\n        callBack: function (res) {\n          ths.setData({\n            totalMoney: res.totalPay,\n          });\n          uni.hideLoading();\n        },\n      };\n      http.request(params);\n    },\n\n    /**\n     * 减少数量\n     */\n    onCountMinus: function (e) {\n      var index = e.currentTarget.dataset.index;\n      var shopcartItems = this.shopcartItems;\n      var prodCount = shopcartItems[index].itemCount;\n\n      if (prodCount > 1) {\n        this.updateCount(shopcartItems, index, -1);\n      } else if (prodCount === 1) {\n        //弹出toast提示框\n        uni.showToast({\n          title: \"宝贝数量不能再减少了\",\n          icon: \"none\",\n        });\n      }\n    },\n\n    /**\n     * 增加数量\n     */\n    onCountPlus: function (e) {\n      var index = e.currentTarget.dataset.index;\n      var shopcartItems = this.shopcartItems;\n      this.updateCount(shopcartItems, index, 1);\n    },\n\n    /**\n     * 改变购物车数量接口\n     */\n    updateCount: function (shopcartItems, index, prodCount) {\n      var ths = this;\n      uni.showLoading({\n        mask: true,\n      });\n      var params = {\n        url: \"/shopcart/shopcartItem/changeItem\",\n        method: \"POST\",\n        data: {\n          itemCount: prodCount,\n          shopcartItemId: shopcartItems[index].shopcartItemId,\n          prodId: shopcartItems[index].prodId,\n          skuId: shopcartItems[index].skuId,\n        },\n        callBack: function (res) {\n          shopcartItems[index].itemCount += prodCount;\n          ths.setData({\n            shopcartItems: shopcartItems,\n            totalMoney: res,\n          });\n          uni.hideLoading();\n          http.getCartCount(); //重新计算购物车总数量\n        },\n      };\n      http.request(params);\n    },\n\n    /**\n     * 删除购物车商品\n     */\n    onDelBasket: function (shopcartItemIds) {\n      var ths = this;\n      var shopcartItems = this.shopcartItems;\n\n      if (shopcartItemIds.length == 0) {\n        uni.showToast({\n          title: \"请选择商品\",\n          icon: \"none\",\n        });\n      } else {\n        uni.showModal({\n          title: \"\",\n          content: \"确认要删除选中的商品吗？\",\n          confirmColor: \"#EC6817\",\n\n          success(res) {\n            if (res.confirm) {\n              uni.showLoading({\n                mask: true,\n              });\n              var params = {\n                url: \"/shopcart/shopcartItem/deleteItems\",\n                method: \"DELETE\",\n                data: { shopcartItemIds },\n                callBack: function (res) {\n                  //后端删除选中商品后,前端对应删除\n                  shopcartItems = shopcartItems.filter(\n                    (item) => !shopcartItemIds.includes(item.shopcartItemId)\n                  );\n                  ths.setData({\n                    shopcartItems: shopcartItems,\n                    totalMoney: res,\n                  });\n                  uni.hideLoading();\n                },\n              };\n              http.request(params);\n            }\n          },\n        });\n      }\n    },\n\n    onDelItem: function (e) {\n      var index = e.currentTarget.dataset.index;\n      var shopcartItems = this.shopcartItems;\n      var shopcartItemIds = [];\n      shopcartItemIds.push(shopcartItems[index].shopcartItemId);\n      this.onDelBasket(shopcartItemIds);\n    },\n\n    onDelChosedItems: function () {\n      var shopcartItems = this.shopcartItems;\n\n      var shopcartItemIds = [];\n\n      for (var i = 0; i < shopcartItems.length; i++) {\n        var shopcartItem = shopcartItems[i];\n\n        if (shopcartItem.isChecked) {\n          shopcartItemIds.push(shopcartItem.shopcartItemId);\n        }\n      }\n      this.onDelBasket(shopcartItemIds);\n    },\n\n    toProdPage: function (e) {\n      var prodid = e.currentTarget.dataset.prodid;\n\n      if (prodid) {\n        uni.navigateTo({\n          url: \"/pages/prod/prod?prodid=\" + prodid,\n        });\n      }\n    },\n\n    //修改购物车中选择的sku\n    updateSku: function (e) {\n      e.stopPropagation();\n      var categoryid = e.currentTarget.dataset.categoryid;\n      var prodid = e.currentTarget.dataset.prodid;\n      var shopcartItemId = e.currentTarget.dataset.shopcartitemid;\n      var attr = e.currentTarget.dataset.attr;\n\n      var index = e.currentTarget.dataset.index;\n      var selectNum = e.currentTarget.dataset.selectnum;\n      var params = {\n        url: \"/prod/prod/skuSelect/\" + categoryid + \"/\" + prodid,\n        method: \"GET\",\n\n        callBack: (res) => {\n          console.log(res.attrSkuMap);\n          this.setData({\n            skuSelectData: res,\n            prodid: prodid,\n            shopcartItemId: shopcartItemId,\n            selectNum: selectNum,\n            attr: attr,\n          });\n\n          this.$refs.skuselect.open(\"bottom\");\n        },\n      };\n      http.request(params);\n    },\n\n    moveHandle() {\n      //禁止父元素滑动\n    },\n    closeSkuselect(isUpdate, sku, shopcartItemId, itemCount, totalPay) {\n      if (isUpdate) {\n        var shopcartItems = this.shopcartItems;\n        this.setData({ totalMoney: totalPay });\n        //更新UI\n        //更新购物车项的sku或者合并已有sku\n        //1.在this.shopcartItems中每一项,寻找是否有已经存在的sku,如果有则合并,并删除以前的项\n        let hasSku = false;\n        let itemIndex = -1;\n        for (var i = 0; i < shopcartItems.length; i++) {\n          var shopcartItem = shopcartItems[i];\n          //其他的购物车项中存在sku\n          if (\n            shopcartItem.skuId === sku.skuId &&\n            shopcartItem.shopcartItemId != shopcartItemId\n          ) {\n            hasSku = true;\n            //合并库存数量\n            shopcartItem.itemCount += itemCount;\n            shopcartItems[i] = shopcartItem;\n          }\n          if (shopcartItem.shopcartItemId === shopcartItemId) {\n            itemIndex = i;\n          }\n        }\n\n        if (hasSku && itemIndex >= 0) {\n          //删除shopcartItems数组中itemIndex的对应项\n          shopcartItems.splice(itemIndex, 1);\n        }\n        //2.不存在sku,不合并,而是修改当前的购物车项\n        else if (!hasSku && itemIndex >= 0) {\n          var shopcartItem = shopcartItems[itemIndex];\n          shopcartItem.skuId = sku.skuId;\n          shopcartItem.prodId = sku.prodId;\n          shopcartItem.sku = sku;\n          shopcartItems[itemIndex] = shopcartItem;\n        }\n        this.setData({ shopcartItems });\n      }\n      this.onPopupClose();\n    },\n    onPopupClose() {\n      this.$refs.skuselect.close();\n    },\n\n    onPopupChange(e) {\n      if (!e.show) {\n        this.setData({\n          skuSelectData: {},\n        });\n      }\n    },\n  },\n};\n</script>\n<style>\n@import \"./basket.css\";\n</style>\n","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./basket.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./basket.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1728895428005\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  ","import mod from \"-!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-filter-loader/index.js!./number.wxs?vue&type=custom&index=0&blockType=script&issuerPath=%2FUsers%2Fzhengheci%2Fhlshop%2Fmall4uni%2Fpages%2Fbasket%2Fbasket.vue&module=wxs&lang=wxs\"; export default mod; export * from \"-!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-filter-loader/index.js!./number.wxs?vue&type=custom&index=0&blockType=script&issuerPath=%2FUsers%2Fzhengheci%2Fhlshop%2Fmall4uni%2Fpages%2Fbasket%2Fbasket.vue&module=wxs&lang=wxs\"","export default function (Component) {\n       if(!Component.options.wxsCallMethods){\n         Component.options.wxsCallMethods = []\n       }\n       \n     }"],"sourceRoot":""}